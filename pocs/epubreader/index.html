<!DOCTYPE html> 
<html lang="en"> 
	<head> 
    	<title>EPub Importer</title> 
		<meta
		      name="viewport"
		      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
		    />
    	<script type="text/javascript" src="js-epub/js-epub.js"></script>
    	<script type="text/javascript" src="js-epub/vendor/js-unzip/js-unzip.js"></script>
    	<script type="text/javascript" src="js-epub/vendor/js-inflate/js-inflate.js"></script>
		<script type="text/javascript" src="js/ebookdownloader.js"></script>
  	</head> 
  	<body> 
    	<input type="text" id="epub" name="epub" size="100" /><input type="button" name="click" id="click" value="Fetch!" />
		<div id="reader">			
			<ul id="books"></ul>
		</div>
		<script type="text/javascript">
			function fetch() {
				var downloader = new owd.eBookDownloader();
				var url = document.getElementById('epub').value;
				
				downloader.download(url, function(metadata) { 
					alert('Book ' + metadata.title + ' downloaded')
					document.getElementById('reader').innerHTML = localStorage[metadata.id];
				},
				function(msg) {
					alert("Error: " + msg);
				})
			}
			
			function loadFromInternalStorage(bookId) {
				document.getElementById('reader').innerHTML = localStorage[bookId];
			}
			
			
			document.getElementById('click').addEventListener('click', fetch, false);
			
			if(localStorage.hasOwnProperty('books')) {
				var books = JSON.parse(localStorage.books);
				
				var ul = document.getElementById('books');
				
				for(var i in books) {
					ul.innerHTML += "<li><a href='#' onClick='javascript:loadFromInternalStorage(\"" + books[i].id + "\")'>" + books[i].title + " by " + books[i].creator + "</a></li>";
				}
			}
		</script>		
  </body> 
</html>